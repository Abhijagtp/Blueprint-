{% extends 'IBW.html' %}

{% block ibw_content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create Blog</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Poppins:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="https://cdn.quilljs.com/1.3.6/quill.snow.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css" />
  <style>
    body { 
      font-family: Inter; 
      background: #f8fafc; 
      color: #1e293b; 
    }
    h5 { 
      font-weight: 500; 
      font-size: 16px; 
      color: #1e293b; 
      padding-bottom: 16px; 
    }
    .card-custom { 
      border-radius: 12px; 
      padding: 20px; 
      border: none; 
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); 
      transition: 0.3s; 
    }
    .card-custom:hover { 
      transform: translateY(-3px); 
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08); 
    }
    .feature-card h6 { 
      font-weight: 600; 
      font-size: 15px; 
      color: #1e293b; 
    }
    .feature-card { 
      background: #f1f5f9; 
      border-radius: 12px; 
      padding: 16px; 
      text-align: left; 
    }
    .img-1 { 
      width: 76px; 
      height: 72px; 
    }
    .img-2 { 
      width: 175px; 
      height: 58px; 
    }
    .feature-card h6 { 
      margin-top: 8px; 
      font-weight: bold; 
    }
    .feature-card p { 
      font-weight: 400; 
      font-size: 13px; 
      color: #64748b; 
    }
    .feature-card a { 
      font-weight: 500; 
      font-size: 14px; 
      color: #3b82f6; 
      text-decoration: none; 
    }
    .feature-card a:hover { 
      cursor: pointer; 
      text-decoration: underline; 
    }
    .card { 
      border-radius: 12px; 
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); 
    }
    .banner-card { 
      position: relative; 
      border-radius: 12px; 
      overflow: hidden; 
      background: url("images/banner-card.png") no-repeat center; 
      background-size: cover; 
      color: white; 
      padding: 24px; 
    }
    .banner-card .overlay { 
      background: rgba(0, 0, 0, 0.5); 
      position: absolute; 
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0; 
      border-radius: 12px; 
    }
    .banner-card .content { 
      position: relative; 
      z-index: 2; 
    }
    .banner-card h5 { 
      color: #ffffff; 
      font-weight: 600; 
      font-size: 15px; 
    }
    .banner-card p { 
      font-size: 13px; 
      font-weight: 300; 
      padding-bottom: 8px; 
    }
    .read { 
      cursor: pointer; 
      color: #ffffff; 
      text-decoration: none; 
    }
    i { 
      width: 20px; 
      height: 20px; 
      cursor: pointer; 
    }
    .editor-container {
  padding: 0;
  border-radius: 12px;
  background: #ffffff;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  border: 1px solid #e2e8f0;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  height: calc(100vh - 100px);
  position: relative;
  overflow: hidden; /* Prevent overflow issues */
}

.editor-content-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
}

/* Toggle Button */
.toolbar-toggle-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 101; /* Above the toolbar */
  background: #ffffff;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 6px;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s ease, transform 0.2s ease;
  cursor: pointer;
}

.toolbar-toggle-btn:hover {
  background: #e2e8f0;
  transform: scale(1.05);
}

.toolbar-toggle-btn i {
  font-size: 16px;
  color: #1e293b;
}

/* Toolbar Wrapper (Slides in from the right) */
.toolbar-wrapper {
  position: absolute;
  top: 0;
  right: -300px; /* Start off-screen to the right */
  width: 280px; /* Fixed width for the toolbar */
  height: 100%;
  background: #ffffff;
  border-left: 1px solid #e2e8f0;
  box-shadow: -2px 0 8px rgba(0, 0, 0, 0.05);
  transition: right 0.3s ease-in-out; /* Slide animation */
  z-index: 100;
  overflow-y: auto; /* Allow vertical scrolling if needed */
  padding: 12px;
}

.toolbar-wrapper.active {
  right: 0; /* Slide in when active */
}

/* Quill Toolbar */
.ql-toolbar.ql-snow {
  background: transparent;
  border: none;
  padding: 0;
  display: flex;
  flex-direction: column; /* Stack buttons vertically */
  gap: 8px;
}

.ql-toolbar.ql-snow .ql-formats {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 0;
  border-bottom: 1px solid #e2e8f0;
}

.ql-toolbar.ql-snow .ql-formats:last-child {
  border-bottom: none;
}

.ql-toolbar.ql-snow button,
.ql-toolbar.ql-snow .ql-picker {
  background: transparent;
  border: none;
  border-radius: 6px;
  padding: 8px;
  min-width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s ease, color 0.2s ease, transform 0.1s ease;
  position: relative;
}

.ql-toolbar.ql-snow button:hover,
.ql-toolbar.ql-snow .ql-picker:hover {
  background: #e2e8f0;
  color: #3b82f6;
}

.ql-toolbar.ql-snow button.ql-active,
.ql-toolbar.ql-snow .ql-picker.ql-active {
  background: #3b82f6;
  color: #ffffff;
}

/* Tooltip Styling */
.ql-toolbar.ql-snow button::after,
.ql-toolbar.ql-snow .ql-picker::after {
  content: attr(data-tooltip);
  position: absolute;
  left: -100px; /* Position to the left of the button */
  top: 50%;
  transform: translateY(-50%);
  background: #1e293b;
  color: #ffffff;
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 4px;
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, visibility 0.2s ease;
  z-index: 1002;
}

.ql-toolbar.ql-snow button:hover::after,
.ql-toolbar.ql-snow .ql-picker:hover::after {
  opacity: 1;
  visibility: visible;
}

/* Picker Label Styling */
.ql-toolbar.ql-snow .ql-picker-label {
  padding: 0;
  font-size: 0;
}

.ql-toolbar.ql-snow .ql-picker-label::before {
  font-family: 'bootstrap-icons';
  font-size: 16px;
  line-height: 1;
}

/* Picker Icons */
.ql-header .ql-picker-label::before {
  content: '\f3f2';
}

.ql-align .ql-picker-label::before {
  content: '\f3e5';
}

.ql-align .ql-picker-item[data-value="center"]::before {
  content: '\f3e6';
}

.ql-align .ql-picker-item[data-value="right"]::before {
  content: '\f3e7';
}

.ql-align .ql-picker-item[data-value="justify"]::before {
  content: '\f3e8';
}

.ql-list .ql-picker-label::before {
  content: '\f3ed';
}

.ql-list .ql-picker-item[data-value="ordered"]::before {
  content: '\f3ee';
}

.ql-list .ql-picker-item[data-value="bullet"]::before {
  content: '\f3ed';
}

.ql-toolbar.ql-snow .ql-color .ql-picker-label::before {
  content: '\f5a0';
}

/* Color Picker Options */
.ql-toolbar.ql-snow .ql-color .ql-picker-options {
  padding: 8px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 4px;
  width: 100px;
  position: absolute;
  top: 50%;
  left: -110px; /* Position to the left of the toolbar */
  transform: translateY(-50%);
  z-index: 1001;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border: 1px solid #e2e8f0;
  background: #ffffff;
  border-radius: 6px;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  padding: 0;
  margin: 0;
  position: relative;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value=""] {
  background: #ffffff;
  border: 1px solid #e2e8f0;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value="#ffffff"] {
  background: #ffffff;
  border: 1px solid #e2e8f0;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value="#000000"] {
  background: #000000;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value="#00ff00"] {
  background: #00ff00;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value="#00ffff"] {
  background: #00ffff;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value="#0000ff"] {
  background: #0000ff;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value="#ff00ff"] {
  background: #ff00ff;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value="#ff0000"] {
  background: #ff0000;
}

.ql-toolbar.ql-snow .ql-color .ql-picker-item[data-value="#ffff00"] {
  background: #ffff00;
}

/* General Picker Options */
.ql-toolbar.ql-snow .ql-picker-options {
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border: 1px solid #e2e8f0;
  background: #ffffff;
  padding: 4px 0;
  position: absolute;
  top: 50%;
  left: -130px; /* Position to the left of the toolbar */
  transform: translateY(-50%);
  z-index: 1001;
  min-width: 120px;
}

.ql-toolbar.ql-snow .ql-picker-item {
  padding: 6px 12px;
  font-size: 13px;
  color: #1e293b;
  transition: background 0.2s ease;
  text-align: left;
}

.ql-toolbar.ql-snow .ql-picker-item:hover {
  background: #f1f5f9;
}

#editor {
  flex: 1;
  border: none;
  background: #ffffff;
  border-radius: 0;
  font-size: 15px;
  color: #1e293b;
  padding: 20px;
  line-height: 1.6;
  overflow-y: auto;
}

.ql-container.ql-snow {
  border: none;
  border-radius: 0;
  background: #ffffff;
  flex: 1;
  overflow: visible;
}

.ql-editor {
  padding: 20px;
  min-height: 200px;
}

.ql-editor::before {
  color: #94a3b8;
  font-style: normal;
  font-size: 15px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .editor-container {
    height: auto;
    min-height: 400px;
  }

  .toolbar-toggle-btn {
    top: 8px;
    right: 8px;
    width: 32px;
    height: 32px;
    padding: 4px;
  }

  .toolbar-toggle-btn i {
    font-size: 14px;
  }

  .toolbar-wrapper {
    width: 240px; /* Smaller width on mobile */
    right: -240px; /* Adjust for smaller width */
  }

  .ql-toolbar.ql-snow button,
  .ql-toolbar.ql-snow .ql-picker {
    min-width: 32px;
    height: 32px;
    padding: 6px;
  }

  .ql-toolbar.ql-snow button::after,
  .ql-toolbar.ql-snow .ql-picker::after {
    font-size: 11px;
    padding: 3px 6px;
    left: -90px;
  }

  .ql-toolbar.ql-snow .ql-picker-label::before {
    font-size: 14px;
  }

  .ql-toolbar.ql-snow .ql-picker-options {
    left: -110px;
  }

  .ql-toolbar.ql-snow .ql-color .ql-picker-options {
    left: -100px;
  }
}

@media (max-width: 576px) {
  .toolbar-toggle-btn {
    top: 6px;
    right: 6px;
    width: 28px;
    height: 28px;
    padding: 3px;
  }

  .toolbar-toggle-btn i {
    font-size: 12px;
  }

  .toolbar-wrapper {
    width: 200px;
    right: -200px;
  }

  .ql-toolbar.ql-snow button,
  .ql-toolbar.ql-snow .ql-picker {
    min-width: 28px;
    height: 28px;
    padding: 4px;
  }

  .ql-toolbar.ql-snow button::after,
  .ql-toolbar.ql-snow .ql-picker::after {
    font-size: 10px;
    padding: 2px 4px;
    left: -80px;
  }

  .ql-toolbar.ql-snow .ql-picker-label::before {
    font-size: 12px;
  }

  .ql-toolbar.ql-snow .ql-picker-options {
    left: -100px;
  }

  .ql-toolbar.ql-snow .ql-color .ql-picker-options {
    left: -90px;
  }
}
    .btn-primary { 
      background-color: #064C89; 
      border-color: #064C89;  
      border-radius: 8px; 
      padding: 8px 16px; 
      font-size: 14px; 
      font-weight: 500; 
      transition: all 0.2s ease-in-out; 
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); 
    }
    .btn-outline-secondary { 
      border-color: #064C89; 
      color: #064C89; 
      border-radius: 8px; 
      padding: 8px 16px; 
      font-size: 14px; 
      font-weight: 500; 
      transition: all 0.2s ease-in-out; 
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); 
    }
    .btn-primary:hover, 
    .btn-outline-secondary:hover { 
      transform: translateY(-1px); 
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); 
    }
    .btn-primary:active, 
    .btn-outline-secondary:active { 
      transform: translateY(0); 
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); 
    }
    .fixed-top-menu { 
      background: white; 
      padding: 12px; 
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); 
    }
    .scrollable-content { 
      height: calc(100vh - 60px); 
      overflow-y: auto; 
      padding: 16px; 
    }
    .elevated-div { 
      background: white; 
      padding: 20px; 
      border-radius: 12px; 
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); 
      border: 1px solid #e2e8f0; 
      transition: box-shadow 0.3s ease; 
    }
    .elevated-div:hover { 
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08); 
    }
    .input-group-text { 
      cursor: pointer; 
      background: #f1f5f9; 
      border: 1px solid #e2e8f0; 
      border-radius: 8px 0 0 8px; 
      transition: background 0.2s ease; 
    }
    .input-group-text:hover { 
      background: #e2e8f0; 
    }
    .input-group .form-control { 
      border-left: none; 
      border-radius: 0 8px 8px 0; 
    }
    label { 
      font-family: Inter; 
      font-weight: 500; 
      font-size: 14px; 
      color: #1e293b; 
      margin-bottom: 8px; 
    }
    .form-control, 
    .form-select { 
      border: 1px solid #e2e8f0; 
      border-radius: 8px; 
      padding: 10px 12px; 
      font-size: 14px; 
      color: #1e293b; 
      transition: border-color 0.2s ease, box-shadow 0.2s ease; 
    }
    .form-control:focus, 
    .form-select:focus { 
      border-color: #3b82f6; 
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); 
      outline: none; 
    }
    .form-control::placeholder { 
      color: #94a3b8; 
    }
    .badge-category { 
      font-family: Inter; 
      border-radius: 20px; 
      border: 1px solid #e2e8f0; 
      background-color: #f1f5f9; 
      color: #1e293b; 
      padding: 6px 12px; 
      font-size: 13px; 
      margin: 4px; 
      display: inline-flex; 
      align-items: center; 
      gap: 6px; 
    }
    .badge-category .btn-close { 
      font-size: 10px; 
      opacity: 0.6; 
    }
    .badge-posted { 
      background-color: #22c55e; 
      color: white; 
      font-size: 12px; 
      padding: 4px 8px; 
      border-radius: 4px; 
    }
    .badge-draft { 
      background-color: #f59e0b; 
      color: white; 
      font-size: 12px; 
      padding: 4px 8px; 
      border-radius: 4px; 
    }
    .preview-slide { 
      position: fixed; 
      bottom: -100%; 
      left: 0; 
      width: 100%; 
      height: 50vh; 
      background: #ffffff; 
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1); 
      z-index: 1000; 
      transition: bottom 0.5s ease-in-out; 
      padding: 20px; 
      overflow-y: auto; 
      border-top-left-radius: 12px; 
      border-top-right-radius: 12px; 
    }
    .preview-slide.active { 
      bottom: 0; 
    }
    .preview-slide h5 { 
      margin-bottom: 12px; 
      font-weight: 500; 
      font-size: 16px; 
      color: #1e293b; 
    }
    .preview-slide .close-preview { 
      position: absolute; 
      top: 16px; 
      right: 16px; 
      font-size: 24px; 
      cursor: pointer; 
      color: #64748b; 
      transition: color 0.2s ease; 
    }
    .preview-slide .close-preview:hover { 
      color: #1e293b; 
    }
    .preview-slide #preview { 
      padding: 16px; 
      background: #f8fafc; 
      border-radius: 8px; 
      min-height: 200px; 
      border: 1px solid #e2e8f0; 
    }
    .modal-content { 
      border-radius: 12px; 
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1); 
      border: none; 
    }
    .modal-header { 
      background: #f8fafc; 
      border-bottom: 1px solid #e2e8f0; 
      border-radius: 12px 12px 0 0; 
      padding: 16px 20px; 
    }
    .modal-title { 
      font-family: Inter; 
      font-weight: 600; 
      font-size: 16px; 
      color: #1e293b; 
      display: flex; 
      align-items: center; 
      gap: 8px; 
    }
    .modal-body { 
      padding: 20px; 
      background: #ffffff; 
    }
    .modal-body label { 
      font-size: 14px; 
      font-weight: 500; 
      color: #1e293b; 
      margin-bottom: 8px; 
      display: block; 
    }
    .modal-body input { 
      border-radius: 8px; 
      border: 1px solid #e2e8f0; 
      padding: 10px 12px; 
      font-size: 14px; 
      color: #1e293b; 
      transition: border-color 0.2s ease, box-shadow 0.2s ease; 
      width: 100%; 
      box-sizing: border-box; 
    }
    .modal-body input:focus { 
      border-color: #3b82f6; 
      outline: none; 
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); 
    }
    .modal-body input::placeholder { 
      color: #94a3b8; 
    }
    .modal-body .char-counter { 
      font-size: 12px; 
      color: #64748b; 
      text-align: right; 
      margin-top: 5px; 
    }
    .modal-body .char-counter.warning { 
      color: #e53e3e; 
    }
    .modal-footer { 
      background: #f8fafc; 
      border-top: 1px solid #e2e8f0; 
      border-radius: 0 0 12px 12px; 
      padding: 12px 20px; 
      justify-content: flex-end; 
    }
    .modal-footer .btn { 
      border-radius: 8px; 
      padding: 8px 16px; 
      font-size: 14px; 
      font-weight: 500; 
      transition: all 0.2s ease; 
    }
    .modal-footer .btn-secondary { 
      background: #ffffff; 
      color: #64748b; 
      border: 1px solid #e2e8f0; 
    }
    .modal-footer .btn-secondary:hover { 
      background: #f1f5f9; 
      color: #1e293b; 
    }
    .modal-footer .btn-primary { 
      background: #3b82f6; 
      border-color: #3b82f6; 
      color: #ffffff; 
    }
    .modal-footer .btn-primary:hover { 
      background: #2563eb; 
      border-color: #2563eb; 
    }
    .thumbnail-container { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
    }
    .hidden { 
      display: none; 
    }
    .media-preview { 
      display: flex; 
      gap: 10px; 
      flex-wrap: wrap; 
      margin-top: 10px; 
    }
    .media-preview img { 
      width: 50px; 
      height: 50px; 
      object-fit: cover; 
      border-radius: 5px; 
    }
    @media (max-width: 768px) {
      .main { 
        display: flex; 
        flex-direction: column; 
      }
      .left, 
      .right { 
        width: 100%; 
      }
      .preview-slide { 
        height: 70vh; 
      }
      .ql-toolbar.ql-snow { 
        flex-wrap: nowrap; 
        padding: 10px 12px; 
      }
      .ql-toolbar.ql-snow .ql-formats { 
        margin-right: 6px; 
        padding-right: 6px; 
      }
      .editor-container { 
        height: auto; 
        min-height: 400px; 
      }
    }
  </style>
</head>
<body>
  <div class="main d-flex">
    <div class="left col-6">
      {% include 'ibw_navbar.html' %}
      <div class="scrollable-content">
        <div class="elevated-div">
          <label class="my-3">Blog Title *</label>
          <input type="text" class="form-control" placeholder="Enter title..." id="blog-title" />

          <label for="languageSelect" class="form-label my-3">Select Language</label>
          <select id="languageSelect" class="form-select mb-2">
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="zh">Chinese</option>
          </select>

          <div class="d-flex flex-column">
            <label class="my-3">Categories</label>
            <button class="btn btn-primary" id="openCategoryModalBtn">
              <i class="bi bi-plus"></i>Add Category
            </button>
            <div id="categoryContainer" class="mt-3"></div>
          </div>

          <div id="thumbnail-section" class="my-3">
            <h5>Blog Thumbnail</h5>
            <p class="text-muted">Please upload square image, size less than 100KB</p>
            <div class="thumbnail-container my-3">
              <img id="thumbnail-preview" src="" class="hidden" width="80" height="80" />
              <input type="file" id="thumbnail-input" class="form-control" accept="image/*" />
              <button class="btn btn-danger hidden" id="delete-thumbnail">DELETE</button>
            </div>
          </div>

          <div id="media-section" class="hidden my-4">
            <h5>Media</h5>
            <p class="text-muted">Add images related to blog</p>
            <input type="file" id="media-input" class="form-control" accept="image/*" multiple />
            <div id="media-preview" class="media-preview"></div>
            <button class="btn btn-danger mt-2 hidden" id="delete-all-media">DELETE ALL</button>
          </div>
        </div>
      </div>
    </div>
    <div class="right col-6 p-3">
      <div class="editor-container">
        <div class="editor-content-wrapper">
          <!-- Toggle Button for Toolbar -->
          <button class="toolbar-toggle-btn" id="toolbarToggleBtn" aria-label="Toggle Toolbar">
            <i class="bi bi-gear"></i>
          </button>
    
          <!-- Toolbar (Slides in from the right) -->
          <div class="toolbar-wrapper" id="toolbarWrapper">
            <div id="toolbar" class="ql-toolbar ql-snow">
              <!-- AI/Magic Tool -->
              <span class="ql-formats">
                <button class="ql-magic" data-tooltip="Magic/AI"><i class="bi bi-stars"></i></button>
              </span>
              <!-- Text Style -->
              <span class="ql-formats">
                <select class="ql-header" data-tooltip="Paragraph Style">
                  <option value="1">Heading 1</option>
                  <option value="2">Heading 2</option>
                  <option value="3">Heading 3</option>
                  <option selected>Paragraph</option>
                </select>
              </span>
              <!-- Text Formatting -->
              <span class="ql-formats">
                <button class="ql-bold" data-tooltip="Bold"><i class="bi bi-type-bold"></i></button>
                <button class="ql-italic" data-tooltip="Italic"><i class="bi bi-type-italic"></i></button>
                <button class="ql-underline" data-tooltip="Underline"><i class="bi bi-type-underline"></i></button>
              </span>
              <!-- Color and Alignment -->
              <span class="ql-formats">
                <select class="ql-color" data-tooltip="Text Color">
                  <option selected value=""></option>
                  <option value="#ffffff"></option>
                  <option value="#000000"></option>
                  <option value="#00ff00"></option>
                  <option value="#00ffff"></option>
                  <option value="#0000ff"></option>
                  <option value="#ff00ff"></option>
                  <option value="#ff0000"></option>
                  <option value="#ffff00"></option>
                </select>
                <select class="ql-align" data-tooltip="Text Alignment">
                  <option selected value=""></option>
                  <option value="center"></option>
                  <option value="right"></option>
                  <option value="justify"></option>
                </select>
              </span>
              <!-- Lists -->
              <span class="ql-formats">
                <select class="ql-list" data-tooltip="List">
                  <option selected value=""></option>
                  <option value="ordered"></option>
                  <option value="bullet"></option>
                </select>
              </span>
              <!-- Media and Links -->
              <span class="ql-formats">
                <button class="ql-link" data-tooltip="Insert Link"><i class="bi bi-link-45deg"></i></button>
                <button class="ql-image" data-tooltip="Insert Image"><i class="bi bi-image"></i></button>
                <button class="ql-video" data-tooltip="Insert Video"><i class="bi bi-camera-video"></i></button>
              </span>
              <!-- Code and More -->
              <span class="ql-formats">
                <button class="ql-code-block" data-tooltip="Code Block"><i class="bi bi-code-slash"></i></button>
                <button class="ql-more" data-tooltip="More Options"><i class="bi bi-three-dots"></i></button>
              </span>
            </div>
          </div>
          <div id="editor"></div>
        </div>
        <div class="post-section d-flex justify-content-end align-items-center gap-2">
          <button class="btn btn-outline-secondary" id="save-draft-button">Save as Draft</button>
          <span id="post-status" class="ms-2"></span>
          <button class="btn btn-primary" id="post-button">Post</button>
          <button class="btn btn-primary" id="preview-button">View Preview</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview Slide-Up -->
  <div class="preview-slide" id="previewSlide">
    <h5>Preview</h5>
    <span class="close-preview" onclick="closePreview()">×</span>
    <div id="preview"></div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="categoryModalLabel">
            <i class="bi bi-tag-fill"></i> Add Category
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <label for="categoryInput">Category Name</label>
          <input type="text" id="categoryInput" class="form-control" placeholder="Enter category" maxlength="50" />
          <div class="char-counter" id="charCounter">0/50</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancelCategoryBtn" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="addCategoryBtn">Add</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    // Register Quill Formats
    const Parchment = Quill.import('parchment');
    const Subscript = new Parchment.Attributor.Class('subscript', 'ql-subscript', { scope: Parchment.Scope.INLINE });
    const Superscript = new Parchment.Attributor.Class('superscript', 'ql-superscript', { scope: Parchment.Scope.INLINE });
    Quill.register(Subscript);
    Quill.register(Superscript);

    const LineHeightAttributor = new Parchment.Attributor.Style('lineheight', 'line-height', {
      scope: Parchment.Scope.BLOCK,
      whitelist: ['1', '1.15', '1.5', '2']
    });
    Quill.register(LineHeightAttributor);

    const icons = Quill.import('ui/icons');
    icons['magic'] = '<i class="bi bi-stars"></i>';
    icons['more'] = '<i class="bi bi-three-dots"></i>';

    // Initialize Quill Editor
    const quill = new Quill('#editor', {
      theme: 'snow',
      placeholder: 'Start writing...',
      modules: {
        toolbar: {
          container: '#toolbar',
          handlers: {
            'magic': function () {
              alert('Magic/AI feature not implemented yet.');
            },
            'more': function () {
              alert('More options not implemented yet.');
            }
          }
        },
        history: { delay: 1000, maxStack: 500, userOnly: true },
        clipboard: { matchVisual: false },
        syntax: { highlight: (text) => hljs.highlightAuto(text).value }
      }
    });

    // Helper function to get CSRF token
    const getCsrfToken = () => {
      const cookie = document.cookie.split('; ').find((row) => row.startsWith('csrftoken='));
      return cookie ? cookie.split('=')[1] : '';
    };

    // Store the current blog ID globally
    let currentBlogId = null;

    // Load Asset on Page Load
    window.onload = () => {
      const currentAsset = localStorage.getItem('currentAsset');
      if (currentAsset) {
        try {
          const assetData = JSON.parse(currentAsset);
          currentBlogId = assetData.id || null;

          const blogTitleInput = document.getElementById('blog-title');
          const languageSelect = document.getElementById('languageSelect');
          const categoryContainer = document.getElementById('categoryContainer');
          const thumbnailPreview = document.getElementById('thumbnail-preview');
          const deleteThumbnailBtn = document.getElementById('delete-thumbnail');
          const mediaSection = document.getElementById('media-section');
          const mediaPreview = document.getElementById('media-preview');
          const deleteAllMediaBtn = document.getElementById('delete-all-media');
          const postButton = document.getElementById('post-button');
          const saveDraftButton = document.getElementById('save-draft-button');
          const postStatus = document.getElementById('post-status');

          blogTitleInput.value = assetData.title || '';
          languageSelect.value = assetData.language || 'en';

          categoryContainer.innerHTML = '';
          if (assetData.categories && assetData.categories.length > 0) {
            assetData.categories.forEach((category) => {
              if (typeof category === 'object' && category.name) {
                category = category.name;
              }
              if (category && category.trim() !== '') {
                const badge = document.createElement('span');
                badge.className = 'badge badge-category p-1 ms-2 mt-2';
                badge.innerHTML = `${category} 
                  <button type="button" class="btn-close btn-close-black ms-2" aria-label="Close" onclick="this.parentElement.remove()"></button>`;
                categoryContainer.appendChild(badge);
              }
            });
          }

          if (assetData.content) {
            quill.root.innerHTML = assetData.content;
          }

          if (assetData.thumbnail) {
            thumbnailPreview.src = assetData.thumbnail;
            thumbnailPreview.classList.remove('hidden');
            deleteThumbnailBtn.classList.remove('hidden');
            mediaSection.classList.remove('hidden');
          }

          if (assetData.media_files && assetData.media_files.length > 0) {
            mediaPreview.innerHTML = '';
            assetData.media_files.forEach((mediaSrc) => {
              const imgWrapper = document.createElement('div');
              imgWrapper.classList.add('position-relative');

              const img = document.createElement('img');
              img.src = mediaSrc;

              const deleteBtn = document.createElement('button');
              deleteBtn.innerHTML = '×';
              deleteBtn.classList.add('btn', 'btn-sm', 'btn-danger', 'position-absolute', 'top-0', 'end-0');
              deleteBtn.addEventListener('click', () => {
                imgWrapper.remove();
                checkMediaCount();
              });

              imgWrapper.appendChild(img);
              imgWrapper.appendChild(deleteBtn);
              mediaPreview.appendChild(imgWrapper);
            });
            deleteAllMediaBtn.classList.remove('hidden');
          }

          if (assetData.is_draft === false) {
            postButton.textContent = 'Update';
            saveDraftButton.disabled = true;
            postStatus.innerHTML = '<span class="badge badge-posted">Posted</span>';
          } else {
            postButton.textContent = 'Post';
            saveDraftButton.disabled = false;
            postStatus.innerHTML = '<span class="badge badge-draft">Draft</span>';
          }

          localStorage.removeItem('currentAsset');
        } catch (e) {
          console.error('Error parsing currentAsset:', e);
        }
      }

      // Attach event listeners after DOM is loaded
      document.getElementById('save-draft-button').addEventListener('click', () => saveDraft());
      document.getElementById('post-button').addEventListener('click', () => saveBlog(false));
      document.getElementById('preview-button').addEventListener('click', () => viewPreview());
    };

    // Collect Blog Data
    const collectBlogData = () => {
      const thumbnailFile = document.getElementById('thumbnail-input').files[0];
      const mediaFiles = document.getElementById('media-input').files;

      return new Promise((resolve) => {
        const data = {
          id: currentBlogId,
          title: document.getElementById('blog-title').value || 'Untitled Blog Draft',
          language: document.getElementById('languageSelect').value,
          categories: Array.from(document.querySelectorAll('#categoryContainer .badge-category'))
            .map((badge) => badge.textContent.trim().replace(/\s*×$/, ''))
            .filter((category) => category.trim() !== ''),
          content: quill.root.innerHTML,
          thumbnail: '',
          media_files: []
        };

        console.log('Collected categories:', data.categories);

        if (thumbnailFile) {
          const reader = new FileReader();
          reader.onload = (e) => {
            data.thumbnail = e.target.result;
            handleMediaFiles(data, mediaFiles, resolve);
          };
          reader.readAsDataURL(thumbnailFile);
        } else if (
          document.getElementById('thumbnail-preview').src &&
          !document.getElementById('thumbnail-preview').classList.contains('hidden')
        ) {
          data.thumbnail = document.getElementById('thumbnail-preview').src;
          handleMediaFiles(data, mediaFiles, resolve);
        } else {
          handleMediaFiles(data, mediaFiles, resolve);
        }
      });
    };

    // Handle Media Files
    const handleMediaFiles = (data, mediaFiles, resolve) => {
      const existingMedia = Array.from(document.querySelectorAll('#media-preview img')).map((img) => img.src);
      data.media_files = [...existingMedia];

      if (mediaFiles && mediaFiles.length > 0) {
        let loadedCount = 0;
        for (let i = 0; i < mediaFiles.length; i++) {
          const reader = new FileReader();
          reader.onload = (e) => {
            data.media_files.push(e.target.result);
            loadedCount++;
            if (loadedCount === mediaFiles.length) {
              resolve(data);
            }
          };
          reader.readAsDataURL(mediaFiles[i]);
        }
      } else {
        resolve(data);
      }
    };

    // Save Draft
    const saveDraft = () => {
      collectBlogData().then((data) => {
        data.is_draft = true;

        fetch('/save-blog/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCsrfToken()
          },
          body: JSON.stringify(data)
        })
          .then((response) => {
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            return response.json();
          })
          .then((result) => {
            if (result.success) {
              currentBlogId = result.id;
              alert('Draft saved successfully!');
              document.getElementById('post-button').textContent = 'Post';
              document.getElementById('save-draft-button').disabled = true;
              document.getElementById('post-status').innerHTML = '<span class="badge badge-draft">Draft</span>';
              window.location.href = '/digitalassets';
            } else {
              alert('Error saving draft: ' + (result.error || 'Unknown error'));
            }
          })
          .catch((error) => {
            console.error('Error in saveDraft:', error);
            alert('An error occurred while saving the draft.');
          });
      });
    };

    // Save Blog
    const saveBlog = (is_draft = false) => {
      collectBlogData().then((data) => {
        data.is_draft = is_draft;

        fetch('/save-blog/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCsrfToken()
          },
          body: JSON.stringify(data)
        })
          .then((response) => {
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            return response.json();
          })
          .then((result) => {
            if (result.success) {
              currentBlogId = result.id;
              alert(result.message || 'Blog saved successfully!');
              if (!is_draft) {
                document.getElementById('post-button').textContent = 'Update';
                document.getElementById('save-draft-button').disabled = true;
                document.getElementById('post-status').innerHTML = '<span class="badge badge-posted">Posted</span>';
              } else {
                document.getElementById('post-button').textContent = 'Post';
                document.getElementById('save-draft-button').disabled = true;
                document.getElementById('post-status').innerHTML = '<span class="badge badge-draft">Draft</span>';
                window.location.href = '/digitalassets.html';
              }
            } else {
              alert('Error saving blog: ' + (result.error || 'Unknown error'));
            }
          })
          .catch((error) => {
            console.error('Error in saveBlog:', error);
            alert('An error occurred while saving the blog.');
          });
      });
    };

    // View Preview
    const viewPreview = () => {
      const content = quill.root.innerHTML;
      document.getElementById('preview').innerHTML = content;
      document.getElementById('previewSlide').classList.add('active');
    };

    // Close Preview
    const closePreview = () => {
      document.getElementById('previewSlide').classList.remove('active');
    };

    // Thumbnail Upload
    document.getElementById('thumbnail-input').addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        if (file.size > 500 * 1024) {
          alert('Thumbnail must be less than 100KB');
          return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
          const thumbnailPreview = document.getElementById('thumbnail-preview');
          const deleteThumbnailBtn = document.getElementById('delete-thumbnail');
          const mediaSection = document.getElementById('media-section');
          thumbnailPreview.src = e.target.result;
          thumbnailPreview.classList.remove('hidden');
          deleteThumbnailBtn.classList.remove('hidden');
          mediaSection.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    // Delete Thumbnail
    document.getElementById('delete-thumbnail').addEventListener('click', () => {
      const thumbnailPreview = document.getElementById('thumbnail-preview');
      const deleteThumbnailBtn = document.getElementById('delete-thumbnail');
      const mediaSection = document.getElementById('media-section');
      thumbnailPreview.src = '';
      thumbnailPreview.classList.add('hidden');
      deleteThumbnailBtn.classList.add('hidden');
      mediaSection.classList.add('hidden');
    });

    // Media Upload
    document.getElementById('media-input').addEventListener('change', (event) => {
      const files = event.target.files;
      const mediaPreview = document.getElementById('media-preview');

      for (let i = 0; i < files.length; i++) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const imgWrapper = document.createElement('div');
          imgWrapper.classList.add('position-relative');

          const img = document.createElement('img');
          img.src = e.target.result;

          const deleteBtn = document.createElement('button');
          deleteBtn.innerHTML = '×';
          deleteBtn.classList.add('btn', 'btn-sm', 'btn-danger', 'position-absolute', 'top-0', 'end-0');
          deleteBtn.addEventListener('click', () => {
            imgWrapper.remove();
            checkMediaCount();
          });

          imgWrapper.appendChild(img);
          imgWrapper.appendChild(deleteBtn);
          mediaPreview.appendChild(imgWrapper);
        };
        reader.readAsDataURL(files[i]);
      }

      document.getElementById('delete-all-media').classList.remove('hidden');
    });

    // Delete All Media Images
    document.getElementById('delete-all-media').addEventListener('click', () => {
      const mediaPreview = document.getElementById('media-preview');
      const deleteAllMediaBtn = document.getElementById('delete-all-media');
      mediaPreview.innerHTML = '';
      deleteAllMediaBtn.classList.add('hidden');
    });

    // Check Media Count to Hide Delete All Button
    const checkMediaCount = () => {
      const mediaPreview = document.getElementById('media-preview');
      const deleteAllMediaBtn = document.getElementById('delete-all-media');
      if (mediaPreview.children.length === 0) {
        deleteAllMediaBtn.classList.add('hidden');
      }
    };

    // Modal Handling
    let categoryModal = null;
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof bootstrap === 'undefined') {
        console.error('Bootstrap JavaScript is not loaded.');
        return;
      }

      const modalElement = document.getElementById('categoryModal');
      categoryModal = new bootstrap.Modal(modalElement, {
        backdrop: 'static',
        keyboard: false
      });

      const categoryInput = document.getElementById('categoryInput');
      const charCounter = document.getElementById('charCounter');
      categoryInput.addEventListener('input', () => {
        const currentLength = categoryInput.value.length;
        const maxLength = parseInt(categoryInput.getAttribute('maxlength'));
        charCounter.textContent = `${currentLength}/${maxLength}`;
        if (currentLength > maxLength * 0.8) {
          charCounter.classList.add('warning');
        } else {
          charCounter.classList.remove('warning');
        }
      });

      modalElement.addEventListener('hidden.bs.modal', () => {
        categoryInput.value = '';
        charCounter.textContent = '0/50';
        charCounter.classList.remove('warning');
      });

      document.getElementById('openCategoryModalBtn').addEventListener('click', () => {
        if (categoryModal) {
          categoryModal.show();
        }
      });
    });

    // Add Category
    document.getElementById('addCategoryBtn').addEventListener('click', (event) => {
      event.preventDefault();
      const categoryInput = document.getElementById('categoryInput');
      const categoryValue = categoryInput.value.trim();

      if (categoryValue !== '') {
        const categoryContainer = document.getElementById('categoryContainer');
        const badge = document.createElement('span');
        badge.className = 'badge badge-category p-1 ms-2 mt-2';
        badge.innerHTML = `${categoryValue} 
          <button type="button" class="btn-close btn-close-black ms-2" aria-label="Close" onclick="this.parentElement.remove()"></button>`;
        categoryContainer.appendChild(badge);

        if (categoryModal) {
          console.log('Attempting to close modal...');
          categoryModal.hide();
          setTimeout(() => {
            if (document.getElementById('categoryModal').classList.contains('show')) {
              console.log('Modal did not close, using fallback...');
              document.getElementById('cancelCategoryBtn').click();
            } else {
              console.log('Modal closed successfully.');
            }
          }, 300);
        } else {
          console.error('categoryModal is not initialized.');
        }
      } else {
        alert('Please enter a category.');
      }
    });
    document.getElementById('toolbarToggleBtn').addEventListener('click', () => {
  const toolbarWrapper = document.getElementById('toolbarWrapper');
  const isExpanded = toolbarWrapper.classList.toggle('active');
  document.getElementById('toolbarToggleBtn').setAttribute('aria-expanded', isExpanded);
});
  </script>
</body>
</html>

{% endblock %}